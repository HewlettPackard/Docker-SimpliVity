(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{179:function(e,t,i){e.exports=i.p+"assets/img/kiali-v1-only.67c68147.png"},180:function(e,t,i){e.exports=i.p+"assets/img/kiali-v1-v3-50.6e2eb484.png"},181:function(e,t,i){e.exports=i.p+"assets/img/kiali-v1-50.40ab0d09.png"},182:function(e,t,i){e.exports=i.p+"assets/img/kiali-v3-50.62e8b40b.png"},316:function(e,t,i){"use strict";i.r(t);var a=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"traffic-management"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#traffic-management","aria-hidden":"true"}},[e._v("#")]),e._v(" Traffic management")]),e._v(" "),a("h2",{attrs:{id:"migrating-traffic-from-one-version-of-a-service-to-another"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#migrating-traffic-from-one-version-of-a-service-to-another","aria-hidden":"true"}},[e._v("#")]),e._v(" Migrating traffic from one version of a service to another")]),e._v(" "),a("p",[e._v("Route all traffic to the "),a("code",[e._v("v1")]),e._v(" version of the services by applying the file "),a("code",[e._v("virtual-service-all-v1.yaml")]),e._v(":")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# kubectl apply -f samples/bookinfo/networking/virtual-service-all-v1.yaml\n")])])]),a("p",[e._v("In particular, the "),a("code",[e._v("reviews")]),e._v(" service is limited to using only "),a("code",[e._v("v1")]),e._v(":")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("apiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: reviews\nspec:\n  hosts:\n  - reviews\n  http:\n  - route:\n    - destination:\n        host: reviews\n        subset: v1\n")])])]),a("p",[e._v("If you refresh the product page in your browser, you will now only ever see the reviews without any (black or red) star ratings.")]),e._v(" "),a("p",[e._v("If you re-run the load generating tool to access the application and then view the graph in Kaili,\nyou will see that only "),a("code",[e._v("v1")]),e._v(" of the reviews service is used:")]),e._v(" "),a("p",[a("img",{attrs:{src:i(179),alt:"Kiali graph for v1 only",title:"Figure: Kiali graph for v1 only"}})]),e._v(" "),a("p",[a("strong",[e._v("Figure.")]),e._v(" Kiali graph for v1 only")]),e._v(" "),a("p",[e._v("Now share the traffic 50/50 between "),a("code",[e._v("v1")]),e._v(" and "),a("code",[e._v("v3")]),e._v(" of the ratings service by applying the file\n"),a("code",[e._v("virtual-service-reviews-50-v3.yaml")]),e._v(":")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# kubectl apply -f samples/bookinfo/networking/virtual-service-reviews-50-v3.yaml\n")])])]),a("p",[e._v("The yaml file splits the reviews 50/50 between "),a("code",[e._v("v1")]),e._v(" and "),a("code",[e._v("v3")]),e._v(":")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("apiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: reviews\nspec:\n  hosts:\n    - reviews\n  http:\n  - route:\n    - destination:\n        host: reviews\n        subset: v1\n      weight: 50\n    - destination:\n        host: reviews\n        subset: v3\n      weight: 50\n")])])]),a("p",[e._v("Wait a few seconds for the new rules to propagate. Now, refresh "),a("code",[e._v("/productpage")]),e._v(" in your browser and you should see\nred colored star ratings approximately 50% of the time. Run the load generation tool again to generate sufficient\ndata for Kiali to graph the distribution of traffic between the two versions of the service.")]),e._v(" "),a("p",[a("img",{attrs:{src:i(180),alt:"Kiali graph with 50/50 split between v1 and v3",title:"Figure: Kiali graph with 50/50 split between v1 and v3"}})]),e._v(" "),a("p",[a("strong",[e._v("Figure.")]),e._v(" Kiali graph with 50/50 split between v1 and v3")]),e._v(" "),a("p",[e._v("You can see the actual amount of traffic for each version of the service by clicking on the appropriate\nedge on the graph. First, click on the "),a("code",[e._v("v1")]),e._v(" edge:")]),e._v(" "),a("p",[a("img",{attrs:{src:i(181),alt:"Kiali graph showing details of v1 traffic",title:"Figure: Kiali graph showing details of v1 traffic"}})]),e._v(" "),a("p",[a("strong",[e._v("Figure.")]),e._v(" Kiali graph showing details of v1 traffic")]),e._v(" "),a("p",[e._v("Now click on the "),a("code",[e._v("v3")]),e._v(" edge:")]),e._v(" "),a("p",[a("img",{attrs:{src:i(182),alt:"Kiali graph showing details of v3 traffic",title:"Figure: Kiali graph showing details of v3 traffic"}})]),e._v(" "),a("p",[a("strong",[e._v("Figure.")]),e._v(" Kiali graph showing details of v3 traffic")]),e._v(" "),a("p",[e._v("The number of requests to the "),a("code",[e._v("v1")]),e._v(" service should be roughly equal to that for the "),a("code",[e._v("v3")]),e._v(" service.")])])}],r=i(0),s=Object(r.a)({},function(){this.$createElement;this._self._c;return this._m(0)},a,!1,null,null,null);s.options.__file="istio-getting-started-4.md";t.default=s.exports}}]);