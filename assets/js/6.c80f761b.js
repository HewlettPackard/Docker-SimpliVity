(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{163:function(e,t,n){e.exports=n.p+"assets/img/bookinfo.92cf7be2.png"},164:function(e,t,n){e.exports=n.p+"assets/img/productpage1st.f314c570.png"},165:function(e,t,n){e.exports=n.p+"assets/img/productpage2nd.ee2a9bc5.png"},166:function(e,t,n){e.exports=n.p+"assets/img/productpage3rd.edf93bd0.png"},312:function(e,t,n){"use strict";n.r(t);var i=[function(){var e=this.$createElement,t=this._self._c||e;return t("h1",{attrs:{id:"deploying-the-bookinfo-application"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#deploying-the-bookinfo-application","aria-hidden":"true"}},[this._v("#")]),this._v(" Deploying the Bookinfo application")])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ul",[n("li",[n("strong",[e._v("productpage:")]),e._v(" The productpage microservice calls the details and reviews microservices to populate the page.")]),e._v(" "),n("li",[n("strong",[e._v("details:")]),e._v(" The details microservice contains book information.")]),e._v(" "),n("li",[n("strong",[e._v("reviews:")]),e._v(" The reviews microservice contains book reviews. It also calls the ratings microservice.")]),e._v(" "),n("li",[n("strong",[e._v("ratings:")]),e._v(" The ratings microservice contains book ranking information that accompanies a book review.")])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ul",[n("li",[e._v("Version "),n("code",[e._v("v1")]),e._v(" doesn’t call the ratings service.")]),e._v(" "),n("li",[e._v("Version "),n("code",[e._v("v2")]),e._v(" calls the ratings service, and displays each rating as 1 to 5 black stars.")]),e._v(" "),n("li",[e._v("Version "),n("code",[e._v("v3")]),e._v(" calls the ratings service, and displays each rating as 1 to 5 red stars.")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("img",{attrs:{src:n(163),alt:' "Bookinfo application"',title:"Figure: Bookinfo application"}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("strong",[this._v("Figure.")]),this._v(" Bookinfo application")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("# cd ~/istio-tutorial\n# kubectl apply -f samples/bookinfo/platform/kube/bookinfo.yaml\n\nservice/details created\ndeployment.extensions/details-v1 created\nservice/ratings created\ndeployment.extensions/ratings-v1 created\nservice/reviews created\ndeployment.extensions/reviews-v1 created\ndeployment.extensions/reviews-v2 created\ndeployment.extensions/reviews-v3 created\nservice/productpage created\ndeployment.extensions/productpage-v1 created\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("# kubectl get deployment\n\nNAME             DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE\ndetails-v1       1         1         1            1           1m\nproductpage-v1   1         1         1            0           59s\nratings-v1       1         1         1            0           1m\nreviews-v1       1         1         1            0           1m\nreviews-v2       1         1         1            0           1m\nreviews-v3       1         1         1            0           59s\n\n\n# kubectl get svc\n\nNAME          TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE\ndetails       ClusterIP   10.96.238.55   <none>        9080/TCP   1m\nkubernetes    ClusterIP   10.96.0.1      <none>        443/TCP    2d\nproductpage   ClusterIP   10.96.239.77   <none>        9080/TCP   1m\nratings       ClusterIP   10.96.171.64   <none>        9080/TCP   1m\nreviews       ClusterIP   10.96.161.13   <none>        9080/TCP   1m\n\nWait for all the pods to have a status of `running`:\n\n# kubectl get pods\nNAME                              READY     STATUS    RESTARTS   AGE\ndetails-v1-67566c8cd-9v7xq        2/2       Running   0          9m\nproductpage-v1-549ccbd868-n4v9d   2/2       Running   0          9m\nratings-v1-69554c6fd6-b75pz       2/2       Running   0          9m\nreviews-v1-7df8c546cc-hn9dr       2/2       Running   0          9m\nreviews-v2-69cbd88965-bcljd       2/2       Running   0          9m\nreviews-v3-645cb56f49-clk8c       2/2       Running   0          9m\n\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("View the details for the "),t("code",[this._v("productpage")]),this._v(" pod and note that there are two containers in the pod - the "),t("code",[this._v("productpage")]),this._v(" itself and the "),t("code",[this._v("istio-proxy")]),this._v(" side-car:")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("# kubectl describe pod productpage-v1-549ccbd868-n4v9d\n\nName:               productpage-v1-549ccbd868-n4v9d\nNamespace:          default\nPriority:           0\nPriorityClassName:  <none>\nNode:               hpe-worker02.am2.cloudra.local/10.15.140.242\nStart Time:         Wed, 08 May 2019 12:50:22 +0000\nLabels:             app=productpage\n                    pod-template-hash=1057768424\n                    version=v1\n...\nContainers:\n  productpage:\n    Container ID:   docker://e1de7bb5b816d54db8e92a0542e07989950466856570681bc60f362b956067a2\n    Image:          istio/examples-bookinfo-productpage-v1:1.10.1\n    Image ID:       docker-pullable://istio/examples-bookinfo-productpage-v1@sha256:a427e10277a814b27c066d9ea5f2605b656fc1948714ed09e55c97342c5a721d\n    Port:           9080/TCP\n...\n   istio-proxy:\n    Container ID:  docker://f9960295d0f6ef967e1f7c037af4bfa22c5111a05ed85fdff0e1e2645857b9c2\n    Image:         docker.io/istio/proxyv2:1.1.5\n    Image ID:      docker-pullable://istio/proxyv2@sha256:1f00a1bfd3f5b9cd8d3088fa254ec8cd95c72711d77999e4da656e4b36a78931\n    Port:          15090/TCP\n...\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("To confirm that the Bookinfo application is running, send a request to it using a "),t("code",[this._v("curl")]),this._v(" command from a container\nin some pod, for example from the "),t("code",[this._v("ratings")]),this._v(" container in the "),t("code",[this._v("ratings")]),this._v(" pod:")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("# kubectl exec -it $(kubectl get pod -l app=ratings -o jsonpath='{.items[0].metadata.name}') -c ratings -- curl productpage:9080/productpage | grep -o \"<title>.*</title>\"\n\n<title>Simple Bookstore App</title>\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h1",{attrs:{id:"expose-bookinfo-application-through-istio-ingress-gateway"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#expose-bookinfo-application-through-istio-ingress-gateway","aria-hidden":"true"}},[this._v("#")]),this._v(" Expose Bookinfo application through Istio Ingress Gateway")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"inspect-the-ingress-gateway"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#inspect-the-ingress-gateway","aria-hidden":"true"}},[this._v("#")]),this._v(" Inspect the Ingress Gateway")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("# kubectl get svc istio-ingressgateway -n istio-system -o yaml\n\napiVersion: v1\nkind: Service\n...\nspec:\n  clusterIP: 10.96.109.164\n  externalTrafficPolicy: Cluster\n  ports:\n  - name: status-port\n    nodePort: 33976\n    port: 15020\n    protocol: TCP\n    targetPort: 15020\n  - name: http2\n    nodePort: 33380\n    port: 80\n    protocol: TCP\n    targetPort: 80\n  - name: https\n    nodePort: 33390\n    port: 443\n    protocol: TCP\n    targetPort: 443\n  - name: tcp\n    nodePort: 33400\n    port: 33400\n    protocol: TCP\n    targetPort: 33400\n  - name: https-kiali\n    nodePort: 33405\n    port: 15029\n    protocol: TCP\n    targetPort: 15029\n  - name: https-prometheus\n    nodePort: 34030\n    port: 15030\n    protocol: TCP\n    targetPort: 15030\n  - name: https-grafana\n    nodePort: 33224\n    port: 15031\n    protocol: TCP\n    targetPort: 15031\n  - name: https-tracing\n    nodePort: 34847\n    port: 15032\n    protocol: TCP\n    targetPort: 15032\n  - name: tls\n    nodePort: 34091\n    port: 15443\n    protocol: TCP\n    targetPort: 15443\n  selector:\n    app: istio-ingressgateway\n    istio: ingressgateway\n    release: istio\n  sessionAffinity: None\n  type: LoadBalancer\nstatus:\n  loadBalancer: {}\n...\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("To view the logs, identify the "),t("code",[this._v("ingressgateway")]),this._v(" pod:")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('# kubectl get pods -n istio-system\n\nNAME                                      READY     STATUS      RESTARTS   AGE\ngrafana-65fd5ddc8b-pwp6z                  1/1       Running     0          22h\nistio-citadel-76d9fcfb85-z5rwn            1/1       Running     0          22h\nistio-cleanup-secrets-1.1.5-wtbwd         0/1       Completed   0          22h\nistio-egressgateway-7675bcf567-rhg6t      1/1       Running     0          22h\nistio-galley-55c748f9df-rcf8r             1/1       Running     0          22h\nistio-grafana-post-install-1.1.5-kckln    0/1       Completed   0          22h\nistio-ingressgateway-65f97ff4b6-mscrg     1/1       Running     0          22h\nistio-pilot-54dcd4d8d-lvf9x               2/2       Running     0          22h\n...\n\nUse `kubectl logs` for the relevant pod:\n\n# kubectl -n istio-system logs istio-ingressgateway-65f97ff4b6-mscrg\n\n2019-05-08T12:25:21.207858Z     info    FLAG: --applicationPorts="[]"\n2019-05-08T12:25:21.207905Z     info    FLAG: --binaryPath="/usr/local/bin/envoy"\n2019-05-08T12:25:21.207909Z     info    FLAG: --concurrency="0"\n2019-05-08T12:25:21.207912Z     info    FLAG: --configPath="/etc/istio/proxy"\n2019-05-08T12:25:21.207916Z     info    FLAG: --connectTimeout="10s"\n2019-05-08T12:25:21.207919Z     info    FLAG: --controlPlaneAuthPolicy="MUTUAL_TLS"\n2019-05-08T12:25:21.207923Z     info    FLAG: --controlPlaneBootstrap="true"\n2019-05-08T12:25:21.207928Z     info    FLAG: --customConfigFile=""\n...\n[2019-05-08T13:07:35.186Z] "GET /productpage HTTP/1.1" 200 - "-" 0 4415 497 497 "192.168.70.64" "Mozilla/5.0 (Windows NT 6.2; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.103 Safari/537.36" "8ded16c5-36b1-9590-84e0-21557cd605c1" "hpe-ucp01.am2.cloudra.local:33380" "192.168.70.5:9080" outbound|9080||productpage.default.svc.cluster.local - 192.168.70.75:80 192.168.70.64:51443 -\n...\n\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"configure-the-ingress-gateway-for-the-bookinfo-application"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#configure-the-ingress-gateway-for-the-bookinfo-application","aria-hidden":"true"}},[this._v("#")]),this._v(" Configure the Ingress Gateway for the Bookinfo application")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("# kubectl apply -f samples/bookinfo/networking/bookinfo-gateway.yaml\n\ngateway.networking.istio.io/bookinfo-gateway created\nvirtualservice.networking.istio.io/bookinfo created\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"view-the-bookinfo-application"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#view-the-bookinfo-application","aria-hidden":"true"}},[this._v("#")]),this._v(" View the Bookinfo application")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("# kubectl get service istio-ingressgateway -n istio-system\n\nNAME                   TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)\nistio-ingressgateway   LoadBalancer   10.96.109.164   <pending>     15020:33976/TCP,80:33380/TCP,443:33390/TCP,33400:33400/TCP,15029:33405/TCP,15030:34030/TCP,15031:33224/TCP,15032:34847/TCP,15443:34091/TCP\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("View the "),t("code",[this._v("productpage")]),this._v(" route using the port on any node in your cluster. In this instance,\naccessing "),t("code",[this._v("http://hpe-ucp01.cloudra.local:33380/productpage")]),this._v("  displays version 1 of the reviews (no stars):")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("img",{attrs:{src:n(164),alt:' "Product page - first time"',title:"Figure: Product page - first time"}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("strong",[this._v("Figure.")]),this._v(" Product page - first time")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("img",{attrs:{src:n(165),alt:' "Product page - second time"',title:"Figure: Product page - second time"}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("strong",[this._v("Figure.")]),this._v(" Product page - second time")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("img",{attrs:{src:n(166),alt:' "Product page - third time"',title:"Figure: Product page - third time"}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("strong",[this._v("Figure.")]),this._v(" Product page - third time")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h1",{attrs:{id:"apply-default-destination-rules"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#apply-default-destination-rules","aria-hidden":"true"}},[this._v("#")]),this._v(" Apply default destination rules")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Before you can use Istio to control the Bookinfo version routing, you need to define the available versions, called subsets, in destination rules. Because we enforced mutual TLS authentication between all clients and\nservers when setting up the demo (using the file "),t("code",[this._v("install/kubernetes/istio-demo-auth.yaml")]),this._v("), you need to use\nthe corresponding version of the destination rules file "),t("code",[this._v("destination-rule-all-mtls.yaml")]),this._v(". If you did not enforce\nmutual TLS, then use the file "),t("code",[this._v("destination-rule-all.yaml")]),this._v(".")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("# kubectl apply -f samples/bookinfo/networking/destination-rule-all-mtls.yaml\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("This file sets up default routing rules for all the services in the application, for example, "),t("code",[this._v("productpage")]),this._v(":")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("apiVersion: networking.istio.io/v1alpha3\nkind: DestinationRule\nmetadata:\n  name: productpage\nspec:\n  host: productpage\n  trafficPolicy:\n    tls:\n      mode: ISTIO_MUTUAL\n  subsets:\n  - name: v1\n    labels:\n      version: v1\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("# kubectl get destinationrules\n\n# kubectl get destinationrules -o yaml\n")])])])}],s=n(0),a=Object(s.a)({},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"content"},[e._m(0),e._v(" "),n("p",[e._v("The standard reference application for getting started with Istio is documented at "),n("a",{attrs:{href:"https://istio.io/docs/examples/bookinfo/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://istio.io/docs/examples/bookinfo/"),n("OutboundLink")],1),e._v(".")]),e._v(" "),n("p",[e._v("The example deploys a sample application composed of four separate microservices used to demonstrate various Istio features. The application displays information about a book, similar to a single catalog entry of an online book store. Displayed on the page is a description of the book, book details (ISBN, number of pages, and so on), and a few book reviews.")]),e._v(" "),n("p",[e._v("The Bookinfo application is broken into four separate microservices:")]),e._v(" "),e._m(1),e._v(" "),n("p",[e._v("There are 3 versions of the reviews microservice:")]),e._v(" "),e._m(2),e._v(" "),n("p",[e._v("The end-to-end architecture of the application is shown below.")]),e._v(" "),e._m(3),e._v(" "),e._m(4),e._v(" "),n("p",[e._v("Apply the Bookinfo yaml file:")]),e._v(" "),e._m(5),n("p",[e._v("View the resources deployed:")]),e._v(" "),e._m(6),e._m(7),e._v(" "),e._m(8),e._m(9),e._v(" "),e._m(10),e._m(11),e._v(" "),e._m(12),e._v(" "),n("p",[e._v("The ingress gateway is deployed as a normal LoadBalancer:")]),e._v(" "),e._m(13),e._m(14),e._v(" "),e._m(15),e._m(16),e._v(" "),n("p",[e._v("Now that the Bookinfo services are up and running, you need to make the application accessible from outside of your Kubernetes cluster, e.g., from a browser. An Istio Gateway is used for this purpose.")]),e._v(" "),e._m(17),e._m(18),e._v(" "),n("p",[e._v("View the service details to determine the port where the application is available (here, port 80 is mapped to 33380)")]),e._v(" "),e._m(19),e._m(20),e._v(" "),e._m(21),e._v(" "),e._m(22),e._v(" "),n("p",[e._v("Refresh the browser - in this instance, we see version 3 of the review (red stars):")]),e._v(" "),e._m(23),e._v(" "),e._m(24),e._v(" "),n("p",[e._v("Refresh the browser again - now we see version 2 of the reviews (black stars):")]),e._v(" "),e._m(25),e._v(" "),e._m(26),e._v(" "),e._m(27),e._v(" "),e._m(28),e._v(" "),e._m(29),e._m(30),e._v(" "),e._m(31),n("p",[e._v("You can see the results of applying the rules with the following commands:")]),e._v(" "),e._m(32),n("p",[e._v("You are now ready to start configuring routing requests.")])])},i,!1,null,null,null);a.options.__file="istio-getting-started-2.md";t.default=a.exports}}]);