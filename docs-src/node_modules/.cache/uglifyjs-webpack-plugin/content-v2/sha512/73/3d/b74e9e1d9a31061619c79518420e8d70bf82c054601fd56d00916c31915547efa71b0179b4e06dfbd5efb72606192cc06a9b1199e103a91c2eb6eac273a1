{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{208:function(e,t,s){\"use strict\";s.r(t);var n=s(0),a=Object(n.a)({},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s(\"div\",{staticClass:\"content\"},[e._m(0),e._v(\" \"),s(\"p\",[e._v(\"Many sample Kubernetes applications are available at \"),s(\"a\",{attrs:{href:\"https://kubernetes.io/docs/tutorials/\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"https://kubernetes.io/docs/tutorials/\"),s(\"OutboundLink\")],1),e._v(\". This section details how to deploy the stateless guestbook application with Redis as documented at \"),s(\"a\",{attrs:{href:\"https://kubernetes.io/docs/tutorials/stateless-application/guestbook/\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"https://kubernetes.io/docs/tutorials/stateless-application/guestbook/\"),s(\"OutboundLink\")],1),e._v(\". When deploying applications, you must be aware that Kubernetes version 1.8 shipped with Docker 2.0 and, as a result, you may have to make changes in some places to the configuration files, particularly with the \"),s(\"code\",[e._v(\"apiVersion\")]),e._v(\" field.\")]),e._v(\" \"),s(\"p\",[e._v(\"The manifest file, included below, specifies a deployment controller that runs a single replica Redis master pod.\")]),e._v(\" \"),e._m(1),e._m(2),e._v(\" \"),e._m(3),s(\"p\",[e._v(\"Query the list of Pods to verify that the Redis master pod is running.\")]),e._v(\" \"),e._m(4),e._m(5),e._v(\" \"),e._m(6),s(\"p\",[e._v(\"The guestbook application needs to communicate with the Redis master to write its data. You need to apply a service to proxy the traffic to the Redis master pod. A service defines a policy to access the pods.\")]),e._v(\" \"),e._m(7),e._m(8),e._v(\" \"),e._m(9),s(\"p\",[e._v(\"Query the list of services to verify that the Redis master service is running.\")]),e._v(\" \"),e._m(10),s(\"p\",[e._v(\"Although the Redis master is a single pod, you can make it highly available to meet traffic demands by adding replica Redis slaves.\")]),e._v(\" \"),e._m(11),e._m(12),e._v(\" \"),e._m(13),s(\"p\",[e._v(\"Query the list of Pods to verify that the Redis slave pods are running.\")]),e._v(\" \"),e._m(14),s(\"p\",[e._v(\"The guestbook application needs to communicate to Redis slaves to read data. To make the Redis slaves discoverable, you need to set up a service that provides transparent load balancing to the set of pods.\")]),e._v(\" \"),e._m(15),e._m(16),e._v(\" \"),e._m(17),s(\"p\",[e._v(\"Query the list of services to verify that the Redis slave service is running.\")]),e._v(\" \"),e._m(18),e._m(19),e._v(\" \"),e._m(20),e._m(21),e._v(\" \"),e._m(22),s(\"p\",[e._v(\"Query the list of pods to verify that the three frontend replicas are running.\")]),e._v(\" \"),e._m(23),s(\"p\",[e._v(\"If you want guests to be able to access your guestbook, you must configure the frontend service to be externally visible, so a client can request the service from outside the container cluster.\")]),e._v(\" \"),e._m(24),e._m(25),e._v(\" \"),e._m(26),e._m(27),e._v(\" \"),e._m(28),e._m(29),e._v(\" \"),s(\"p\",[e._v('![ \"Guestbook UI\"][media-k8s-guestbook1-png]')]),e._v(\" \"),e._m(30)])},[function(){var e=this.$createElement,t=this._self._c||e;return t(\"h1\",{attrs:{id:\"kubernetes-guestbook-example-with-redis\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#kubernetes-guestbook-example-with-redis\",\"aria-hidden\":\"true\"}},[this._v(\"#\")]),this._v(\" Kubernetes guestbook example with Redis\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[this._v(\"# cat redis-master-deployment.yaml\\napiVersion: apps/**v1beta2**  # for versions before 1.9.0 use apps/v1beta2\\nkind: Deployment\\nmetadata:\\n  name: redis-master\\n  labels:\\n    app: redis\\nspec:\\n  selector:\\n    matchLabels:\\n      app: redis\\n      role: master\\n      tier: backend\\n  replicas: 1\\n  template:\\n    metadata:\\n      labels:\\n        app: redis\\n        role: master\\n        tier: backend\\n    spec:\\n      containers:\\n      - name: master\\n        image: k8s.gcr.io/redis:e2e  # or just image: redis\\n        resources:\\n          requests:\\n            cpu: 100m\\n            memory: 100Mi\\n        ports:\\n        - containerPort: 6379\\n\\n\")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"p\",[this._v(\"Apply the Redis master deployment from the \"),t(\"code\",[this._v(\"redis-master-deployment.yaml\")]),this._v(\" file:\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[this._v(\"# kubectl apply -f redis-master-deployment.yaml\\n\")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[this._v(\"# kubectl get pods\\nNAME                            READY     STATUS    RESTARTS   AGE\\n**redis-master-5f8d48b75f-8ztt4**   1/1       Running   0          33s\\n\\n\")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"p\",[this._v(\"Use the \"),t(\"code\",[this._v(\"kubectl logs\")]),this._v(\" command to view the logs from the Redis master pod:\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[this._v(\"[root@gab-ansible guestbook]#  kubectl logs -f  **redis-master-5f8d48b75f-8ztt4**\\n                _._\\n           _.-``__ ''-._\\n      _.-``    `.  `_.  ''-._           Redis 2.8.19 (00000000/0) 64 bit\\n  .-`` .-```.  ```\\\\/    _.,_ ''-._\\n (    '      ,       .-`  | `,    )     Running in stand alone mode\\n |`-._`-...-` __...-.``-._|'` _.-'|     Port: 6379\\n |    `-._   `._    /     _.-'    |     PID: 1\\n  `-._    `-._  `-./  _.-'    _.-'\\n |`-._`-._    `-.__.-'    _.-'_.-'|\\n |    `-._`-._        _.-'_.-'    |           http://redis.io\\n  `-._    `-._`-.__.-'_.-'    _.-'\\n |`-._`-._    `-.__.-'    _.-'_.-'|\\n |    `-._`-._        _.-'_.-'    |\\n  `-._    `-._`-.__.-'_.-'    _.-'\\n      `-._    `-.__.-'    _.-'\\n          `-._        _.-'\\n              `-.__.-'\\n\\n[1] 24 Aug 15:24:06.575 # Server started, Redis version 2.8.19\\n[1] 24 Aug 15:24:06.576 # WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command 'echo never > /sys/kernel/mm/transparent_hugepage/enabled' as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.\\n[1] 24 Aug 15:24:06.576 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.\\n[1] 24 Aug 15:24:06.576 * The server is now ready to accept connections on port 6379\\n\\n\")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[this._v(\"# cat redis-master-service.yaml\\napiVersion: v1\\nkind: Service\\nmetadata:\\n  name: redis-master\\n  labels:\\n    app: redis\\n    role: master\\n    tier: backend\\nspec:\\n  ports:\\n  - port: 6379\\n    targetPort: 6379\\n  selector:\\n    app: redis\\n    role: master\\n    tier: backend\\n\\n\")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"p\",[this._v(\"Apply the Redis master service from the \"),t(\"code\",[this._v(\"redis-master-service.yaml\")]),this._v(\" file:\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[this._v('#  kubectl apply -f redis-master-service.yaml\\nservice \"redis-master\" created\\n\\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[this._v(\"#  kubectl get service\\nNAME           TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE\\nkubernetes     ClusterIP   10.96.0.1       <none>        443/TCP    2d\\nredis-master   ClusterIP   10.96.174.129   <none>        6379/TCP   1m\\n\\n\")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[this._v(\"# cat redis-slave-deployment.yaml\\napiVersion: apps/**v1beta2** # for versions before 1.9.0 use apps/v1beta2\\nkind: Deployment\\nmetadata:\\n  name: redis-slave\\n  labels:\\n    app: redis\\nspec:\\n  selector:\\n    matchLabels:\\n      app: redis\\n      role: slave\\n      tier: backend\\n  replicas: 2\\n  template:\\n    metadata:\\n      labels:\\n        app: redis\\n        role: slave\\n        tier: backend\\n    spec:\\n      containers:\\n      - name: slave\\n        image: gcr.io/google_samples/gb-redisslave:v1\\n        resources:\\n          requests:\\n            cpu: 100m\\n            memory: 100Mi\\n        env:\\n        - name: GET_HOSTS_FROM\\n          value: dns\\n          # Using `GET_HOSTS_FROM=dns` requires your cluster to\\n          # provide a dns service. As of Kubernetes 1.3, DNS is a built-in\\n          # service launched automatically. However, if the cluster you are using\\n          # does not have a built-in DNS service, you can instead\\n          # access an environment variable to find the master\\n          # service's host. To do so, comment out the 'value: dns' line above, and\\n          # uncomment the line below:\\n          # value: env\\n        ports:\\n        - containerPort: 6379\\n\\n\")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"p\",[this._v(\"Create the Redis slaves from the \"),t(\"code\",[this._v(\"redis-slave-deployment.yaml\")]),this._v(\" file.\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[this._v('# kubectl apply -f  redis-slave-deployment.yaml\\ndeployment.apps \"redis-slave\" created\\n\\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[this._v(\"# kubectl get pods\\nNAME                            READY     STATUS    RESTARTS   AGE\\nredis-master-5f8d48b75f-8ztt4   1/1       Running   0          39m\\nredis-slave-58fb7bb9b5-25z4m    1/1       Running   0          1m\\nredis-slave-58fb7bb9b5-q8zn9    1/1       Running   0          1m\\n\\n\")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[this._v(\"# cat redis-slave-service.yaml\\napiVersion: v1\\nkind: Service\\nmetadata:\\n  name: redis-slave\\n  labels:\\n    app: redis\\n    role: slave\\n    tier: backend\\nspec:\\n  ports:\\n  - port: 6379\\n  selector:\\n    app: redis\\n    role: slave\\n    tier: backend\\n\\n\")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"p\",[this._v(\"Deploy the Redis slave service from the \"),t(\"code\",[this._v(\"redis-slave-service.yaml\")]),this._v(\" file\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[this._v('# kubectl apply -f redis-slave-service.yaml\\nservice \"redis-slave\" created\\n\\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[this._v(\"# kubectl get services\\nNAME           TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE\\nkubernetes     ClusterIP   10.96.0.1       <none>        443/TCP    2d\\nredis-master   ClusterIP   10.96.174.129   <none>        6379/TCP   30m\\nredis-slave    ClusterIP   10.96.82.175    <none>        6379/TCP   3m\\n\\n\")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"p\",[this._v(\"The guestbook application has a web frontend written in PHP serving the HTTP requests. It is configured to connect to the \"),t(\"code\",[this._v(\"redis-master\")]),this._v(\" service for write requests and the \"),t(\"code\",[this._v(\"redis-slave\")]),this._v(\" service for read requests.\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[this._v(\"# cat frontend-deployment.yaml\\napiVersion: **apps/v1beta2** # for versions before 1.9.0 use apps/v1beta2\\nkind: Deployment\\nmetadata:\\n  name: frontend\\n  labels:\\n    app: guestbook\\nspec:\\n  selector:\\n    matchLabels:\\n      app: guestbook\\n      tier: frontend\\n  replicas: 3\\n  template:\\n    metadata:\\n      labels:\\n        app: guestbook\\n        tier: frontend\\n    spec:\\n      containers:\\n      - name: php-redis\\n        image: gcr.io/google-samples/gb-frontend:v4\\n        resources:\\n          requests:\\n            cpu: 100m\\n            memory: 100Mi\\n        env:\\n        - name: GET_HOSTS_FROM\\n          value: dns\\n          # Using `GET_HOSTS_FROM=dns` requires your cluster to\\n          # provide a dns service. As of Kubernetes 1.3, DNS is a built-in\\n          # service launched automatically. However, if the cluster you are using\\n          # does not have a built-in DNS service, you can instead\\n          # access an environment variable to find the master\\n          # service's host. To do so, comment out the 'value: dns' line above, and\\n          # uncomment the line below:\\n          # value: env\\n        ports:\\n        - containerPort: 80\\n\\n\")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"p\",[this._v(\"Create the frontend deployment using the \"),t(\"code\",[this._v(\"frontend-deployment.yaml\")]),this._v(\" file.\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[this._v('# kubectl apply -f frontend-deployment.yaml\\ndeployment.apps \"frontend\" created\\n\\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[this._v(\"# kubectl get pods -l app=guestbook -l tier=frontend\\nNAME                        READY     STATUS    RESTARTS   AGE\\nfrontend-574b66f649-2qh6h   1/1       Running   0          7m\\nfrontend-574b66f649-782mr   1/1       Running   0          7m\\nfrontend-574b66f649-mnbc9   1/1       Running   0          7m\\n\\n\")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[this._v(\"# cat frontend-service.yaml\\napiVersion: v1\\nkind: Service\\nmetadata:\\n  name: frontend\\n  labels:\\n    app: guestbook\\n    tier: frontend\\nspec:\\n  # comment or delete the following line if you want to use a LoadBalancer\\n  **type: NodePort**\\n  # if your cluster supports it, uncomment the following to automatically create\\n  # an external load-balanced IP for the frontend service.\\n  # type: LoadBalancer\\n  ports:\\n  - port: 80\\n  selector:\\n    app: guestbook\\n    tier: frontend\\n\\n\")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"p\",[this._v(\"Deploy the \"),t(\"code\",[this._v(\"frontend\")]),this._v(\" service using the \"),t(\"code\",[this._v(\"frontend-service.yaml\")]),this._v(\" file\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[this._v('# kubectl apply -f frontend-service.yaml\\nservice \"frontend\" created\\n\\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"p\",[this._v(\"Query the list of services to verify that the \"),t(\"code\",[this._v(\"frontend\")]),this._v(\" service is running.\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[this._v(\"# kubectl get services\\nNAME           TYPE        CLUSTER-IP      EXTERNAL-IP      PORT(S)        AGE\\nfrontend       NodePort    10.96.14.76     <none>        80:**35440**/TCP   15s\\nkubernetes     ClusterIP   10.96.0.1       <none>        443/TCP        2d\\nredis-master   ClusterIP   10.96.174.129   <none>        6379/TCP       54m\\nredis-slave    ClusterIP   10.96.82.175    <none>        6379/TCP       27m\\n\\n\")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"p\",[this._v(\"Access the UI, using the identified port, at \"),t(\"code\",[this._v(\"http://gab-ucp03.cloudra.local:**35440**/\")]),this._v(\" as shown in \"),t(\"a\",{attrs:{href:\"#k8s-guestbook1\"}},[this._v(\"#k8s-guestbook1\")]),this._v(\".\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"p\",[t(\"strong\",[this._v(\"Figure 21.\")]),this._v(\" Guestbook UI\")])}],!1,null,null,null);a.options.__file=\"k8s-example-guestbook.md\";t.default=a.exports}}]);","extractedComments":[]}