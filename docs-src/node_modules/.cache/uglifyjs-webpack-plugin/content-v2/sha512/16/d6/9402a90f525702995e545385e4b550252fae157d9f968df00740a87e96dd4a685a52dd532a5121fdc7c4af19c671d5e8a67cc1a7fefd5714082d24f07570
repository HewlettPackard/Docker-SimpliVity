{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{206:function(e,t,s){\"use strict\";s.r(t);var n=s(0),a=Object(n.a)({},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s(\"div\",{staticClass:\"content\"},[e._m(0),e._v(\" \"),e._m(1),e._v(\" \"),s(\"ul\",[e._m(2),e._v(\" \"),s(\"li\",[e._v(\"Install the \"),s(\"code\",[e._v(\"kubectl\")]),e._v(\" binary on your Ansible box as documented at \"),s(\"a\",{attrs:{href:\"https://docs.docker.com/ee/ucp/user-access/kubectl/\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"https://docs.docker.com/ee/ucp/user-access/kubectl/\"),s(\"OutboundLink\")],1)]),e._v(\" \"),s(\"li\",[e._v(\"Install the UCP Client bundle for the \"),s(\"code\",[e._v(\"admin\")]),e._v(\" user as described at \"),s(\"a\",{attrs:{href:\"https://docs.docker.com/ee/ucp/user-access/cli/#download-client-certificates-by-using-the-rest-api\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"https://docs.docker.com/ee/ucp/user-access/cli/#download-client-certificates-by-using-the-rest-api\"),s(\"OutboundLink\")],1)]),e._v(\" \"),e._m(3)]),e._v(\" \"),e._m(4),e._v(\" \"),s(\"p\",[e._v(\"Once the prerequisites are satisfied, run the appropriate playbook on your Ansible node:\")]),e._v(\" \"),e._m(5),e._m(6),e._v(\" \"),s(\"p\",[e._v(\"In this example, it is assumed that the relevant variables are configured as follows:\")]),e._v(\" \"),e._m(7),e._v(\" \"),s(\"p\",[e._v(\"In this instance, the server IP is set to the NFS VM that has been deployed.\")]),e._v(\" \"),e._m(8),e._v(\" \"),e._m(9),e._m(10),e._v(\" \"),e._m(11),e._m(12),e._v(\" \"),e._m(13),e._m(14),e._v(\" \"),e._m(15),s(\"p\",[e._v(\"Verify that the corresponding persistent volume (PV) was created at the same time.\")]),e._v(\" \"),e._m(16),e._m(17),e._v(\" \"),e._m(18),e._m(19),e._v(\" \"),e._m(20),e._m(21),e._v(\" \"),e._m(22),e._m(23),e._v(\" \"),e._m(24),e._m(25),e._v(\" \"),e._m(26)])},[function(){var e=this.$createElement,t=this._self._c||e;return t(\"h1\",{attrs:{id:\"deploying-the-nfs-provisioner-for-kubernetes\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#deploying-the-nfs-provisioner-for-kubernetes\",\"aria-hidden\":\"true\"}},[this._v(\"#\")]),this._v(\" Deploying the NFS provisioner for Kubernetes\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"h2\",{attrs:{id:\"prerequisites\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#prerequisites\",\"aria-hidden\":\"true\"}},[this._v(\"#\")]),this._v(\" Prerequisites\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"li\",[this._v(\"Configure the variables described in the section \"),t(\"a\",{attrs:{href:\"#\"}},[this._v(\"#\")])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"li\",[this._v(\"Confirm that you can connect to the cluster by running a test command, for example, \"),t(\"code\",[this._v(\"kubectl get nodes\")])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"h2\",{attrs:{id:\"running-the-playbook\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#running-the-playbook\",\"aria-hidden\":\"true\"}},[this._v(\"#\")]),this._v(\" Running the playbook\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[this._v(\"# cd Docker-SimpliVity\\n# ansible-playbook -i vm_hosts playbooks/k8s-nfs-provisioner.yml --vault-password-file .vault_pass\\n\\n\")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"h2\",{attrs:{id:\"using-nfs-vm-for-post-deployment-verification\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#using-nfs-vm-for-post-deployment-verification\",\"aria-hidden\":\"true\"}},[this._v(\"#\")]),this._v(\" Using NFS VM for post-deployment verification\")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s(\"table\",[s(\"thead\",[s(\"tr\",[s(\"th\",{staticStyle:{\"text-align\":\"left\"}},[e._v(\"Variable\")]),e._v(\" \"),s(\"th\",{staticStyle:{\"text-align\":\"left\"}},[e._v(\"Value\")])])]),e._v(\" \"),s(\"tbody\",[s(\"tr\",[s(\"td\",{staticStyle:{\"text-align\":\"left\"}},[e._v(\"nfs_provisioner_role\")]),e._v(\" \"),s(\"td\",{staticStyle:{\"text-align\":\"left\"}},[s(\"code\",[e._v(\"nfs-provisioner-runner\")])])]),e._v(\" \"),s(\"tr\",[s(\"td\",{staticStyle:{\"text-align\":\"left\"}},[e._v(\"nfs_provisioner_name\")]),e._v(\" \"),s(\"td\",{staticStyle:{\"text-align\":\"left\"}},[s(\"code\",[e._v(\"hpe.com/nfs\")])])]),e._v(\" \"),s(\"tr\",[s(\"td\",{staticStyle:{\"text-align\":\"left\"}},[e._v(\"nfs_provisioner_storage_class_name\")]),e._v(\" \"),s(\"td\",{staticStyle:{\"text-align\":\"left\"}},[s(\"code\",[e._v(\"**nfs**\")])])]),e._v(\" \"),s(\"tr\",[s(\"td\",{staticStyle:{\"text-align\":\"left\"}},[e._v(\"nfs_provisioner_server_ip\")]),e._v(\" \"),s(\"td\",{staticStyle:{\"text-align\":\"left\"}},[s(\"code\",[e._v(\"hpe-nfs.cloudra.local\")])])]),e._v(\" \"),s(\"tr\",[s(\"td\",{staticStyle:{\"text-align\":\"left\"}},[e._v(\"nfs_provisioner_server_share\")]),e._v(\" \"),s(\"td\",{staticStyle:{\"text-align\":\"left\"}},[s(\"code\",[e._v(\"/k8s\")])])])])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"p\",[this._v(\"Ensure that your environment satisfies the prerequisites as described in \"),t(\"a\",{attrs:{href:\"#\"}},[this._v(\"#\")]),this._v(\" and then run the playbook:\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[this._v(\"# cd Docker-SimpliVity\\n# ansible-playbook -i vm_hosts playbooks/k8s-nfs-provisioner.yml --vault-password-file .vault_pass\\n\\n\")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"p\",[this._v(\"Running the command \"),t(\"code\",[this._v(\"kubectl get sc\")]),this._v(\" will show the storage class named \"),t(\"code\",[this._v(\"nfs\")]),this._v(\":\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[this._v(\"\\n# kubectl get sc\\nNAME      PROVISIONER   AGE\\nnfs       hpe.com/nfs   5m\\n\\n\")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"p\",[this._v(\"Create a temporary file \"),t(\"code\",[this._v(\"/tmp/pvc.yml\")]),this._v(\" for a persistent volume claim (PVC) named \"),t(\"code\",[this._v(\"dynnfs-testpvc\")]),this._v(\" with a storage class of \"),t(\"code\",[this._v(\"nfs\")])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[this._v('# cat /tmp/pvc.yml <<EOF\\n---\\nkind: PersistentVolumeClaim\\napiVersion: v1\\nmetadata:\\n  name: **dynnfs-testpvc**\\n  annotations:\\n    volume.beta.kubernetes.io/storage-class: \"**nfs**\"\\nspec:\\n  accessModes:\\n    - ReadWriteMany\\n  resources:\\n    requests:\\n      storage: 100Mi\\nEOF  \\n\\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"p\",[this._v(\"Create the PVC resource by running \"),t(\"code\",[this._v(\"kubectl apply\")]),this._v(\" on this file.\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[this._v('# kubectl apply -f /tmp/pvc.yml\\npersistentvolumeclaim \"dynnfs-testpvc\" created\\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[this._v(\"# kubectl get pv\\nNAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS    CLAIM                    STORAGECLASS   REASON    AGE\\npvc-e685a9d2-8a6f-11e8-9025-0242ac110010   100Mi      RWX            Delete           Bound     default/dynnfs-testpvc   nfs                      4s\\n\\n\")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"p\",[this._v(\"Define a pod that will mount the persistent volume through using the persistent volume claim. The persistent volume is mounted under \"),t(\"code\",[this._v(\"/tmp/foo\")]),this._v(\".\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[this._v(\"cat /tmp/pod.yml <<EOF\\napiVersion: apps/v1beta2\\nkind: Deployment\\nmetadata:\\n  name: **dynnfs-testpod**\\nspec:\\n  selector:\\n    matchLabels:\\n      app: dynnfs-testpod\\n  replicas: 1\\n  template:\\n    metadata:\\n      labels:\\n        app: dynnfs-testpod\\n    spec:\\n      volumes:\\n      - name: pod-data\\n        persistentVolumeClaim:\\n          claimName: **dynnfs-testpvc**\\n      containers:\\n      - name: dynnfs-testpod\\n        command:\\n        - sh\\n        - -c\\n        - while true; do sleep 1; done\\n        image: radial/busyboxplus:curl\\n        volumeMounts:\\n        - mountPath: **/tmp/foo**\\n          name: pod-data\\nEOF\\n\")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"p\",[this._v(\"Create the pod resource by running \"),t(\"code\",[this._v(\"kubectl apply\")]),this._v(\" on the file.\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[this._v('# kubectl apply -f /tmp/pod.yml\\ndeployment.apps \"dynnfs-testpod\" created\\n\\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"p\",[this._v(\"Retrieve the pod ID and then execute a command in the pod to create a test file on the persistent volume. The file is named \"),t(\"code\",[this._v(\"/tmp/foo/bar.txt\")]),this._v(\" and contains the string \"),t(\"code\",[this._v(\"hello\")]),this._v(\".\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[this._v(\"# pod=$(kubectl get pod | awk '/dynnfs-testpod-/ {print $1}')\\n# kubectl exec -it $pod -- sh -c \\\"**echo hello \\\\>/tmp/foo/bar.txt**\\\"\\n\")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"p\",[this._v(\"In this example, where the NFS VM is being used as the storage back-end, you can examine the content of the folder containing the persistent volumes. Given the values specified above, where the NFS VM is named \"),t(\"code\",[this._v(\"hpe-nfs\")]),this._v(\" and the \"),t(\"code\",[this._v(\"nfs_provisioner_server_share\")]),this._v(\" is \"),t(\"code\",[this._v(\"k8s\")]),this._v(\", you can connect to the VM and explore the folder as follows.\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[this._v(\"\\n# ssh hpe-nfs ls -R /k8s\\n/k8s:\\ndefault-dynnfs-testpvc-pvc-e685a9d2-8a6f-11e8-9025-0242ac110010\\n \\n/k8s/default-dynnfs-testpvc-pvc-e685a9d2-8a6f-11e8-9025-0242ac110010:\\n**bar.txt**\\n\")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"p\",[this._v(\"Examine the contents of the file to ensure that the string \"),t(\"code\",[this._v(\"hello\")]),this._v(\" has been persisted in the file \"),t(\"code\",[this._v(\"bar.txt\")]),this._v(\".\")])},function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[this._v(\"\\n# ssh hpe-nfs cat /k8s/default-dynnfs-testpvc-pvc-e685a9d2-8a6f-11e8-9025-0242ac110010/bar.txt\\n**hello**\\n\")])])])}],!1,null,null,null);a.options.__file=\"k8s-nfs-provisioner.md\";t.default=a.exports}}]);","extractedComments":[]}