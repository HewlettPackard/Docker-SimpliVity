(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{296:function(e,t,a){"use strict";a.r(t);var s=a(0),n=Object(s.a)({},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content"},[e._m(0),e._v(" "),a("p",[e._v("This post is based on "),a("a",{attrs:{href:"https://github.com/knative/docs/blob/master/install/getting-started-knative-app.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/knative/docs/blob/master/install/getting-started-knative-app.md"),a("OutboundLink")],1)]),e._v(" "),a("p",[e._v("This post uses the Hello World sample app in Go to demonstrate the basic workflow for deploying an app.")]),e._v(" "),e._m(1),e._v(" "),a("p",[e._v("Following the instructions at "),a("a",{attrs:{href:"https://github.com/knative/docs/blob/master/install/Knative-with-any-k8s.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/knative/docs/blob/master/install/Knative-with-any-k8s.md"),a("OutboundLink")],1)]),e._v(" "),e._m(2),e._v(" "),a("p",[e._v("Try to install Istio using the following command:")]),e._v(" "),e._m(3),a("p",[e._v("You will probably see the error:")]),e._v(" "),e._m(4),a("p",[e._v("You need to download the "),a("a",{attrs:{href:"https://github.com/knative/serving/releases/download/v0.4.0/istio-crds.yaml",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/knative/serving/releases/download/v0.4.0/istio-crds.yaml"),a("OutboundLink")],1),e._v(" file locally and modify the ports used, to fall within this range:")]),e._v(" "),e._m(5),e._v(" "),e._m(6),a("p",[e._v("to:")]),e._v(" "),e._m(7),a("p",[e._v("Re-apply, using the modified local file:")]),e._v(" "),e._m(8),e._m(9),e._v(" "),e._m(10),a("p",[e._v("Monitor the Istio components until all of the components show a STATUS of Running or Completed:")]),e._v(" "),e._m(11),e._m(12),e._v(" "),e._m(13),a("p",[e._v("If you see an error such as:")]),e._v(" "),e._m(14),a("p",[e._v("you may be hitting a known issue:")]),e._v(" "),e._m(15),a("p",[e._v("Simply re-run the command a second time to re-apply the same files.")]),e._v(" "),a("p",[e._v("Monitor the Knative components until all of the components show a STATUS of Running:")]),e._v(" "),e._m(16),e._m(17),e._v(" "),a("p",[e._v("To deploy an app using Knative, you need a configuration .yaml file that defines a Service.")]),e._v(" "),a("p",[e._v("This configuration file specifies metadata about the application, points to the hosted image of the app for deployment, and allows the deployment to be configured.")]),e._v(" "),e._m(18),e._v(" "),e._m(19),e._m(20),e._v(" "),e._m(21),a("p",[e._v("Now that your service is created, Knative will perform the following steps:")]),e._v(" "),e._m(22),e._v(" "),e._m(23),e._v(" "),a("p",[e._v("To see if your app has been deployed succesfully, you need the host URL and IP address created by Knative.")]),e._v(" "),e._m(24),e._v(" "),e._m(25),e._m(26),e._v(" "),e._m(27),e._m(28),e._v(" "),e._m(29),a("p",[e._v("Check that the changes to the service have been made:")]),e._v(" "),e._m(30),e._m(31),e._v(" "),a("p",[e._v("To find the host URL for your service, enter:")]),e._v(" "),e._m(32),e._m(33),e._v(" "),e._m(34),e._m(35),e._v(" "),a("p",[e._v("To remove the sample app from your cluster, delete the service record:")]),e._v(" "),e._m(36)])},[function(){var e=this.$createElement,t=this._self._c||e;return t("h1",{attrs:{id:"getting-started-with-knative"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#getting-started-with-knative","aria-hidden":"true"}},[this._v("#")]),this._v(" Getting started with knative")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h1",{attrs:{id:"install-knative"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#install-knative","aria-hidden":"true"}},[this._v("#")]),this._v(" Install knative")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"install-istio"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#install-istio","aria-hidden":"true"}},[this._v("#")]),this._v(" Install Istio")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("kubectl apply --filename https://github.com/knative/serving/releases/download/v0.4.0/istio-crds.yaml && \\\nkubectl apply --filename https://github.com/knative/serving/releases/download/v0.4.0/istio.yaml\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('The Service "istio-ingressgateway" is invalid: spec.ports[0].nodePort: Invalid value: 31380: provided port is not in the valid range. The range of valid ports is 32768-35535\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Change the "),t("code",[this._v("nodePort")]),this._v(" values from 31380, 31390, 31400 to  33380, 33390, 33400:")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("...\napiVersion: v1\nkind: Service\nmetadata:\n  name: istio-ingressgateway\n  namespace: istio-system\n  annotations:\n  labels:\n    chart: gateways-1.0.1\n    release: RELEASE-NAME\n    heritage: Tiller\n    app: istio-ingressgateway\n    istio: ingressgateway\nspec:\n  type: LoadBalancer\n  selector:\n    app: istio-ingressgateway\n    istio: ingressgateway\n  ports:\n    -\n      name: http2\n      nodePort: 31380\n      port: 80\n      targetPort: 80\n    -\n      name: https\n      nodePort: 31390\n      port: 443\n    -\n      name: tcp\n      nodePort: 31400\n      port: 31400\n....\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("...\napiVersion: v1\nkind: Service\nmetadata:\n  name: istio-ingressgateway\n  namespace: istio-system\n  annotations:\n  labels:\n    chart: gateways-1.0.1\n    release: RELEASE-NAME\n    heritage: Tiller\n    app: istio-ingressgateway\n    istio: ingressgateway\nspec:\n  type: LoadBalancer\n  selector:\n    app: istio-ingressgateway\n    istio: ingressgateway\n  ports:\n    -\n      name: http2\n      nodePort: 33380\n      port: 80\n      targetPort: 80\n    -\n      name: https\n      nodePort: 33390\n      port: 443\n    -\n      name: tcp\n      nodePort: 33400\n      port: 31400\n...\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("kubectl apply --filename istio.yaml\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Label the default namespace with "),t("code",[this._v("istio-injection=enabled")]),this._v(":")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("# kubectl label namespace default istio-injection=enabled\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("# kubectl get pods --namespace istio-system\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"install-knative-and-dependencies"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#install-knative-and-dependencies","aria-hidden":"true"}},[this._v("#")]),this._v(" Install knative and dependencies")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("kubectl apply --filename https://github.com/knative/serving/releases/download/v0.4.0/serving.yaml \\\n--filename https://github.com/knative/build/releases/download/v0.4.0/build.yaml \\\n--filename https://github.com/knative/eventing/releases/download/v0.4.0/release.yaml \\\n--filename https://github.com/knative/eventing-sources/releases/download/v0.4.0/release.yaml \\\n--filename https://github.com/knative/serving/releases/download/v0.4.0/monitoring.yaml \\\n--filename https://raw.githubusercontent.com/knative/serving/v0.4.0/third_party/config/build/clusterrole.yaml\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('unable to recognize "https://github.com/knative/eventing/releases/download/v0.4.0/release.yaml": no matches for kind "ClusterChannelProvisioner" in version "eventing.knative.dev/v1alpha1"\nunable to recognize "https://github.com/knative/eventing/releases/download/v0.4.0/release.yaml": no matches for kind "ClusterChannelProvisioner" in version "eventing.knative.dev/v1alpha1"\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("https://github.com/knative/eventing/issues/680\n\nIt fails the first time because the `ClusterChannelProvisioner` CRD hasn't been fully reconciled yet when the in-memory-channel provisioner is created. The second time usually succeeds (because the CRD has been reconciled by then).\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("kubectl get pods --namespace knative-serving\nkubectl get pods --namespace knative-build\nkubectl get pods --namespace knative-eventing\nkubectl get pods --namespace knative-sources\nkubectl get pods --namespace knative-monitoring\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h1",{attrs:{id:"deploying-your-serverless-app"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#deploying-your-serverless-app","aria-hidden":"true"}},[this._v("#")]),this._v(" Deploying your serverless app")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Create a new file named "),t("code",[this._v("service.yaml")]),this._v(" with the following content:")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('# cat service.yaml\n\napiVersion: serving.knative.dev/v1alpha1 # Current version of Knative\nkind: Service\nmetadata:\n  name: helloworld-go # The name of the app\n  namespace: default # The namespace the app will use\nspec:\n  runLatest:\n    configuration:\n      revisionTemplate:\n        spec:\n          container:\n            image: gcr.io/knative-samples/helloworld-go # The URL to the image of the app\n            env:\n              - name: TARGET # The environment variable printed out by the sample app\n                value: "Go Sample v1"\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("From the directory where the new "),t("code",[this._v("service.yaml")]),this._v(" file was created, apply the configuration:")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("# kubectl apply --filename service.yaml\n\nservice.serving.knative.dev/helloworld-go created\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[this._v("Create a new immutable revision for this version of the app.")]),this._v(" "),t("li",[this._v("Perform network programming to create a route, ingress, service, and load balancer for your app.")]),this._v(" "),t("li",[this._v("Automatically scale your pods up and down based on traffic, including to zero active pods.")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h1",{attrs:{id:"interacting-with-your-app"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#interacting-with-your-app","aria-hidden":"true"}},[this._v("#")]),this._v(" Interacting with your app")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Use "),t("code",[this._v("kubectl get svc")]),this._v(" to see the details of the service:")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("[root@hpe-ansible knative]# kubectl get svc istio-ingressgateway --namespace istio-system\nNAME                   TYPE           CLUSTER-IP     EXTERNAL-IP   PORT(S)                                                                                                                   AGE\nistio-ingressgateway   LoadBalancer   10.96.72.109   <pending>     80:33380/TCP,443:33390/TCP,31400:33400/TCP,15011:33994/TCP,8060:34944/TCP,853:35094/TCP,15030:33326/TCP,15031:34179/TCP   1h\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Patch the type to be "),t("code",[this._v("NodePort")]),this._v(":")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('# kubectl -n istio-system patch svc istio-ingressgateway --type=\'json\' -p \'[{"op":"replace","path":"/spec/type","value":"NodePort"}]\'\n\nservice/istio-ingressgateway patched\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("And patch the port to be, for example, "),t("code",[this._v("33333")]),this._v(":")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('# kubectl -n istio-system patch svc istio-ingressgateway --type=\'json\' -p \'[{"op": "add", "path":"/spec/ports/0/nodePort", "value":33333}]\'\n\nservice/istio-ingressgateway patched\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("# kubectl get svc istio-ingressgateway --namespace istio-system -o yaml\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h1",{attrs:{id:"test-service"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#test-service","aria-hidden":"true"}},[this._v("#")]),this._v(" Test service")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("# kubectl get ksvc helloworld-go  --output=custom-columns=NAME:.metadata.name,DOMAIN:.status.domain\n\nNAME                DOMAIN\nhelloworld-go       helloworld-go.default.example.com\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Simply use "),t("code",[this._v("curl")]),this._v(" to test the service, specifing the appropriate port and domain:")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('# curl -vH "Host: helloworld-go.default.example.com" http://hpe2-ucp01.am2.cloudra.local:33333\n\nHello Go Sample v1!\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h1",{attrs:{id:"teardown"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#teardown","aria-hidden":"true"}},[this._v("#")]),this._v(" Teardown")])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("# kubectl delete --filename service.yaml\n")])])])}],!1,null,null,null);n.options.__file="knative-getting-started.md";t.default=n.exports}}]);